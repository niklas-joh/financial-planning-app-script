{"chunk":37,"numChunks":54,"fileHash":"vN+W2tDiA59Daq+vJZZ4NvNU8baK6mDpzqFA2kTr3NY=","filePath":"cline/clasp-pull/src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    addExpenseCategoriesSection(startRow) {\n      if (this.data.expenseCategories.length > 0) {\n        sortedCategories.forEach((category) => {\n          categoryValues.push([category.category]);\n          typeValues.push([category.type]);\n          amountValues.push([category.amount]);\n          \n          // Calculate percentage of income\n          if (this.totals.income.value > 0) {\n            percentFormulas.push([`=C${startRow + currentCategoryRow}/${this.totals.income.value}`]);\n          } else {\n            percentFormulas.push([0]);\n          }\n          \n          // Set target rate based on expense type\n          let targetRate = this.config.TARGET_RATES.DEFAULT; // Default\n          if (category.type === \"Essentials\") {\n            targetRate = this.config.TARGET_RATES.ESSENTIALS;\n          } else if (category.type === \"Wants/Pleasure\") {\n            targetRate = this.config.TARGET_RATES.WANTS_PLEASURE;\n          } else if (category.type === \"Extra\") {\n            targetRate = this.config.TARGET_RATES.EXTRA;\n          }\n          \n          targetValues.push([targetRate]);\n          \n          // Calculate variance (actual % - target %)\n          varianceFormulas.push([`=D${startRow + currentCategoryRow}-E${startRow + currentCategoryRow}`]);\n          \n          // Set background color\n          backgroundColors.push([categoryBgColor, categoryBgColor, categoryBgColor, categoryBgColor, categoryBgColor, categoryBgColor]);\n          \n          // Add conditional formatting for the variance column\n          conditionalFormatRules.push({\n            row: startRow + currentCategoryRow,\n            rule: SpreadsheetApp.newConditionalFormatRule()\n              .whenFormulaSatisfied(`F${startRow + currentCategoryRow}>0`)\n              .setBackground"}