{"chunk":22,"numChunks":54,"fileHash":"vN+W2tDiA59Daq+vJZZ4NvNU8baK6mDpzqFA2kTr3NY=","filePath":"cline/clasp-pull/src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    addKeyMetricsSection(startRow) {\n      if (this.totals.income.row > 0 && this.totals.essentials.row > 0) {\n        metricValues.push([\"Essentials Rate\"]);\n        metricFormulas.push([`=${this.totals.essentials.value}/${this.totals.income.value}`]);\n        metricTargets.push([this.config.TARGET_RATES.ESSENTIALS]);\n        metricDescriptions.push([\"Percentage of income spent on essential expenses (lower is better)\"]);\n        metricBackgrounds.push([metricBgColor]);\n        \n        // Add conditional formatting (red if exceeding target)\n        const targetCell = this.analysisSheet.getRange(startRow + currentMetricRow, 3);\n        const valueCell = this.analysisSheet.getRange(startRow + currentMetricRow, 2);\n        \n        conditionalFormatRules.push({\n          row: startRow + currentMetricRow,\n          rule: SpreadsheetApp.newConditionalFormatRule()\n            .whenFormulaSatisfied(`B${startRow + currentMetricRow}>C${startRow + currentMetricRow}`)\n            .setBackground(\"#FFCDD2\") // Light red if above target\n            .setRanges([valueCell])\n        });\n        \n        currentMetricRow++;\n      }\n      // 3. Wants/Pleasure Rate"}