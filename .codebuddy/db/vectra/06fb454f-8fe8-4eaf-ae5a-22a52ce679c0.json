{"chunk":26,"numChunks":54,"fileHash":"vN+W2tDiA59Daq+vJZZ4NvNU8baK6mDpzqFA2kTr3NY=","filePath":"cline/clasp-verify/src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    addKeyMetricsSection(startRow) {\n      if (this.totals.income.row > 0 && this.totals.savings.row > 0) {\n        metricValues.push([\"Savings Rate\"]);\n        metricFormulas.push([`=-${this.totals.savings.value}/${this.totals.income.value}`]);\n        metricTargets.push([this.config.TARGET_RATES.DEFAULT]); // Use config target rate\n        metricDescriptions.push([\"Positive % indicates saving money, negative % indicates withdrawing from savings\"]);\n        metricBackgrounds.push([metricBgColor]);\n        \n        // Add conditional formatting (green if meeting target, red if not)\n        const targetCell = this.analysisSheet.getRange(startRow + currentMetricRow, 3);\n        const valueCell = this.analysisSheet.getRange(startRow + currentMetricRow, 2);\n        \n        conditionalFormatRules.push({\n          row: startRow + currentMetricRow,\n          rule: SpreadsheetApp.newConditionalFormatRule()\n            .whenFormulaSatisfied(`B${startRow + currentMetricRow}<C${startRow + currentMetricRow}`)\n            .setBackground(\"#FFCDD2\") // Light red if below target\n            .setRanges([valueCell])\n        });\n        \n        currentMetricRow++;\n      }\n      // Add another separator\n      if (currentMetricRow > 0) {\n        metricValues.push([\"\"]);\n        metricFormulas.push([\"\"]);\n        metricTargets.push([\"\"]);\n        metricDescriptions.push([\"\"]);\n        metricBackgrounds.push([\"#E0E0E0\"]); // Light gray separator\n        \n        // Add a horizontal line for visual separation\n        this.analysisSheet.getRange(startRow + currentMetricRow, 1, 1, 4)\n          .setBorder(false, false, true, false, false, false, \"#BDB"}