{"chunk":6,"numChunks":37,"fileHash":"p+NTwC3zq/FPOmXxcPSDB6QbnKDyg9Iv5YKb19s7AmA=","filePath":"src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    constructor(spreadsheet, overviewSheet, analysisConfig) {\n      this.spreadsheet = spreadsheet;\n      this.overviewSheet = overviewSheet;\n      this.config = analysisConfig;\n      this.analysisSheet = utils.getOrCreateSheet(spreadsheet, this.config.SHEETS.ANALYSIS);\n      \n      let formatString;\n      const globalConfigInstance = config; \n      const globalLocale = globalConfigInstance.getLocale ? globalConfigInstance.getLocale() : null;\n\n      if (globalLocale && globalLocale.NUMBER_FORMATS && globalLocale.NUMBER_FORMATS.CURRENCY_DEFAULT) {\n          formatString = globalLocale.NUMBER_FORMATS.CURRENCY_DEFAULT;\n      } else {\n          if (this.config && this.config.LOCALE && this.config.LOCALE.NUMBER_FORMATS && this.config.LOCALE.NUMBER_FORMATS.CURRENCY_DEFAULT) {\n              formatString = this.config.LOCALE.NUMBER_FORMATS.CURRENCY_DEFAULT;\n          }\n      }\n\n      if (!formatString) {\n          formatString = '_-[$€-0]* #,##0_-;_-[RED][$€-0]* #,##0_-;* \"-\";_-@_-'; \n          Logger.log(\"Warning: CURRENCY_DEFAULT not found in configuration. Using hardcoded default for FinancialAnalysisService.\");\n      }\n      this.currencyFormatDefault = formatString;\n      this.data = null;\n      this.totals = null;\n    }\n    initialize() {\n      this.extractDataFromOverview();\n      this.setupAnalysisSheet();\n    }\n    analyze() {\n      let currentRow = 2; // Start after main sheet header\n      currentRow = this.addKeyMetricsSection(currentRow);\n      currentRow += 1; \n      currentRow = this.addExpenseCategoriesSection(currentRow);\n      currentRow += 2; \n      this.createExpend"}