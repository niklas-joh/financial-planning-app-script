{"chunk":32,"numChunks":35,"fileHash":"KnGRZfWKIc39Wbh8b5JI+OtSMVtmab0GI6OHguWwGLg=","filePath":"src/features/financial-analysis/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(\n) {\n  class FinancialAnalysisService {\n    buildExpenseAnalysis(metrics) {\n      const categories = metrics.categories.expenses\n        .filter(c => !c.subcategory)\n        .sort((a, b) => b.amount - a.amount);\n      this.builder\n        .addSectionHeader('Expense Categories', {\n          merge: 6,\n          background: config.getSection('COLORS').UI.HEADER_BG,\n          fontWeight: 'bold',\n          fontColor: config.getSection('COLORS').UI.HEADER_FONT,\n          horizontalAlignment: 'center'\n        })\n        .addHeaderRow(['Category', 'Type', 'Amount', '% of Income', 'Target %', 'Variance'], {\n          background: '#F5F5F5',\n          fontWeight: 'bold',\n          horizontalAlignment: 'center'\n        });\n      const categoryData = [];\n      const varianceFormulas = [];\n      categories.forEach((cat, index) => {\n        let targetRate = config.getSection('TARGET_RATES').DEFAULT;\n        if (cat.type === \"Essentials\") targetRate = config.getSection('TARGET_RATES').ESSENTIALS;\n        else if (cat.type === \"Wants/Pleasure\") targetRate = config.getSection('TARGET_RATES').WANTS;\n        else if (cat.type === \"Extra\") targetRate = config.getSection('TARGET_RATES').EXTRA;\n        \n        const currentRow = this.builder.getCurrentRow() + index;\n        \n        categoryData.push([\n          cat.category,\n          cat.type,\n          cat.amount,\n          '', // Will be replaced by formula\n          targetRate,\n          ''  // Will be replaced by formula\n        ]);\n        \n        varianceFormulas.push({\n          row: currentRow,\n          percentFormula: `=IFERROR(C${currentRow}/${metrics.income.averageRef},0)`,\n          varianceFormula: `=D${currentRow}-"}