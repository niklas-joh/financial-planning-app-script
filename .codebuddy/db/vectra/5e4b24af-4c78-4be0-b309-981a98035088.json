{"chunk":20,"numChunks":37,"fileHash":"p+NTwC3zq/FPOmXxcPSDB6QbnKDyg9Iv5YKb19s7AmA=","filePath":"src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    addKeyMetricsSection(startRow) {\n      const createMetricCard = (metricConf, cardStartRow, startCardColumn) => {\n        if (metricConf.totalFormula) {\n          annualValueCell.setFormula(metricConf.totalFormula)\n            .setFontSize(18).setFontColor('#008000')\n            .setHorizontalAlignment('center').setVerticalAlignment('middle');\n        } else if (metricConf.targetValue !== undefined) {\n          annualValueCell.setValue(metricConf.targetValue)\n            .setFontSize(18).setFontColor('#008000')\n            .setHorizontalAlignment('center').setVerticalAlignment('middle');\n        } else {\n          annualValueCell.setValue('')\n            .setHorizontalAlignment('center').setVerticalAlignment('middle');\n        }\n        if (metricConf.valueType === 'currency') {\n          monthlyValueCell.setNumberFormat(serviceInstance.currencyFormatDefault);\n          if (metricConf.totalFormula) annualValueCell.setNumberFormat(serviceInstance.currencyFormatDefault);\n        } else if (metricConf.valueType === 'percentage') {\n          monthlyValueCell.setNumberFormat('0.00%');\n          if (metricConf.totalFormula || metricConf.targetValue !== undefined) {\n            if (typeof metricConf.targetValue === 'number') {\n                annualValueCell.setNumberFormat('0.00%');\n            }\n          }\n        }\n        sheet.getRange(sparklineRow, startCardColumn, 1, cardWidth).merge()\n          .setValue(metricConf.sparklinePlaceholderText || `[Sparkline: ${metricConf.name}]`)\n          .setHorizontalAlignment('center').setVerticalAlignment('middle')\n          .setFontStyle('italic').setFontColor('#AAAAAA');\n        sheet.getRange(labelsRow, startCardColumn, 1, 1)\n          .setValue(metricConf.avgLabel || 'Monthly Avg.')\n          .setFontSize(9"}