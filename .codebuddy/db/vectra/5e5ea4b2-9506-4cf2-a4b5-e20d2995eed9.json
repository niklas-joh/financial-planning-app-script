{"chunk":24,"numChunks":54,"fileHash":"vN+W2tDiA59Daq+vJZZ4NvNU8baK6mDpzqFA2kTr3NY=","filePath":"cline/clasp-verify/src/services/financial_analysis.js","content":"/**\nFinancialPlanner.FinancialAnalysisService = (function(utils, uiService, errorService, config) {\n  class FinancialAnalysisService {\n    addKeyMetricsSection(startRow) {\n      if (this.totals.income.row > 0 && this.totals.extra.row > 0) {\n        metricValues.push([\"Extra Expenses Rate\"]);\n        metricFormulas.push([`=${this.totals.extra.value}/${this.totals.income.value}`]);\n        metricTargets.push([this.config.TARGET_RATES.EXTRA]);\n        metricDescriptions.push([\"Percentage of income spent on extra/miscellaneous expenses\"]);\n        metricBackgrounds.push([metricBgColor]);\n        \n        // Add conditional formatting (red if exceeding target)\n        const targetCell = this.analysisSheet.getRange(startRow + currentMetricRow, 3);\n        const valueCell = this.analysisSheet.getRange(startRow + currentMetricRow, 2);\n        \n        conditionalFormatRules.push({\n          row: startRow + currentMetricRow,\n          rule: SpreadsheetApp.newConditionalFormatRule()\n            .whenFormulaSatisfied(`B${startRow + currentMetricRow}>C${startRow + currentMetricRow}`)\n            .setBackground(\"#FFCDD2\") // Light red if above target\n            .setRanges([valueCell])\n        });\n        \n        currentMetricRow++;\n      }\n      // Add separator (empty row with light gray background)\n      if (currentMetricRow > 0) {\n        metricValues.push([\"\"]);\n        metricFormulas.push([\"\"]);\n        metricTargets.push([\"\"]);\n        metricDescriptions.push([\"\"]);\n        metricBackgrounds.push([\"#E0E0E0\"]); // Light gray separator\n        \n        // Add a horizontal line for visual separation\n        this.analysisSheet.getRange(startRow + currentMetricRow, 1, 1, 4)\n          .setBorder(false, false, true, false, false, false, \"#BDBDBD\", SpreadsheetApp.BorderStyle.SOLID);\n        \n"}